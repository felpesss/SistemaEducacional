<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema Educacional</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    
    <header class="header">
        <div class="header-content">
            <h1>üéì Sistema Educacional</h1>
            <div class="user-info">
                <span>Ol√°, <strong id="userName">Usu√°rio</strong></span>
                <button class="logout-btn" onclick="logout()">Sair</button>
            </div>
        </div>
    </header>
    
    <main class="container">
        
        <div id="alert" class="alert"></div>
        
        <!-- Se√ß√µes de Gerenciamento -->
        <div id="managementSections" style="display:none;">
            
            <!-- ESTRUTURA ACAD√äMICA -->
            <section class="card section-academic">
                <h2>üìö Estrutura Acad√™mica</h2>
                
                <!-- Cursos -->
                <div class="subsection">
                    <h3>Cursos Oferecidos</h3>
                    <form id="cursoForm">
                        <input type="hidden" id="cursoId">
                        <div class="form-row">
                            <div class="form-group">
                                <label>Nome do Curso</label>
                                <input type="text" id="cursoNome" required placeholder="Ex: An√°lise e Desenvolvimento de Sistemas">
                            </div>
                            <div class="form-group">
                                <label>Carga Hor√°ria</label>
                                <input type="number" id="cursoCargaHoraria" required placeholder="Ex: 2400">
                            </div>
                            <div class="form-group">
                                <label>Dura√ß√£o (semestres)</label>
                                <input type="number" id="cursoDuracao" required placeholder="Ex: 5">
                            </div>
                        </div>
                        <div class="form-group">
                            <label>Descri√ß√£o</label>
                            <input type="text" id="cursoDescricao" placeholder="Descri√ß√£o do curso">
                        </div>
                        <button type="submit" class="btn btn-primary">Salvar Curso</button>
                        <button type="button" class="btn btn-secondary" onclick="limparFormCurso()">Limpar</button>
                    </form>
                    <table id="cursosTable">
                        <thead><tr><th>ID</th><th>Nome</th><th>Carga Hor√°ria</th><th>Dura√ß√£o</th><th>A√ß√µes</th></tr></thead>
                        <tbody></tbody>
                    </table>
                </div>
                
                <!-- Disciplinas -->
                <div class="subsection">
                    <h3>Disciplinas</h3>
                    <form id="disciplinaForm">
                        <input type="hidden" id="disciplinaId">
                        <div class="form-row">
                            <div class="form-group">
                                <label>Nome da Disciplina</label>
                                <input type="text" id="disciplinaNome" required placeholder="Ex: Programa√ß√£o Orientada a Objetos">
                            </div>
                            <div class="form-group">
                                <label>Carga Hor√°ria</label>
                                <input type="number" id="disciplinaCargaHoraria" required placeholder="Ex: 80">
                            </div>
                            <div class="form-group">
                                <label>Curso</label>
                                <select id="disciplinaCurso" required><option value="">Selecione o curso...</option></select>
                            </div>
                        </div>
                        <button type="submit" class="btn btn-primary">Salvar Disciplina</button>
                        <button type="button" class="btn btn-secondary" onclick="limparFormDisciplina()">Limpar</button>
                    </form>
                    <table id="disciplinasTable">
                        <thead><tr><th>ID</th><th>Nome</th><th>Carga Hor√°ria</th><th>Curso</th><th>A√ß√µes</th></tr></thead>
                        <tbody></tbody>
                    </table>
                </div>
            </section>

            <!-- CORPO DOCENTE E TURMAS -->
            <section class="card section-staff">
                <h2>üë®‚Äçüè´ Corpo Docente e Turmas</h2>
                
                <!-- Professores -->
                <div class="subsection">
                    <h3>Professores</h3>
                    <form id="professorForm">
                        <input type="hidden" id="professorId">
                        <div class="form-row">
                            <div class="form-group">
                                <label>Nome Completo</label>
                                <input type="text" id="professorNome" required placeholder="Ex: Carlos Mendes">
                            </div>
                            <div class="form-group">
                                <label>CPF</label>
                                <input type="text" id="professorCpf" required placeholder="000.000.000-00">
                            </div>
                            <div class="form-group">
                                <label>Email</label>
                                <input type="email" id="professorEmail" required placeholder="professor@email.com">
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label>Telefone</label>
                                <input type="text" id="professorTelefone" placeholder="(11) 99999-9999">
                            </div>
                            <div class="form-group">
                                <label>Especialidade</label>
                                <input type="text" id="professorEspecialidade" placeholder="Ex: Banco de Dados">
                            </div>
                        </div>
                        <button type="submit" class="btn btn-primary">Salvar Professor</button>
                        <button type="button" class="btn btn-secondary" onclick="limparFormProfessor()">Limpar</button>
                    </form>
                    <table id="professoresTable">
                        <thead><tr><th>ID</th><th>Nome</th><th>CPF</th><th>Email</th><th>Especialidade</th><th>A√ß√µes</th></tr></thead>
                        <tbody></tbody>
                    </table>
                </div>
                
                <!-- Turmas -->
                <div class="subsection">
                    <h3>Turmas</h3>
                    <form id="turmaForm">
                        <input type="hidden" id="turmaId">
                        <div class="form-row">
                            <div class="form-group">
                                <label>Nome da Turma</label>
                                <input type="text" id="turmaNome" required placeholder="Ex: POO-2025-1A">
                            </div>
                            <div class="form-group">
                                <label>Disciplina</label>
                                <select id="turmaDisciplina" required><option value="">Selecione a disciplina...</option></select>
                            </div>
                            <div class="form-group">
                                <label>Professor</label>
                                <select id="turmaProfessor" required><option value="">Selecione o professor...</option></select>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label>Semestre</label>
                                <input type="number" id="turmaSemestre" required placeholder="1 ou 2">
                            </div>
                            <div class="form-group">
                                <label>Ano</label>
                                <input type="number" id="turmaAno" required value="2025" placeholder="2025">
                            </div>
                            <div class="form-group">
                                <label>Hor√°rio</label>
                                <input type="text" id="turmaHorario" placeholder="Ex: Seg/Qua 19h-21h">
                            </div>
                        </div>
                        <button type="submit" class="btn btn-primary">Salvar Turma</button>
                        <button type="button" class="btn btn-secondary" onclick="limparFormTurma()">Limpar</button>
                    </form>
                    <table id="turmasTable">
                        <thead><tr><th>ID</th><th>Nome</th><th>Disciplina</th><th>Professor</th><th>Per√≠odo</th><th>A√ß√µes</th></tr></thead>
                        <tbody></tbody>
                    </table>
                </div>
            </section>

            <!-- MATR√çCULAS E NOTAS -->
            <section class="card section-enrollment">
                <h2>üìù Matr√≠culas e Avalia√ß√µes</h2>
                
                <!-- Matr√≠culas -->
                <div class="subsection">
                    <h3>Matr√≠culas</h3>
                    <form id="matriculaForm">
                        <input type="hidden" id="matriculaId">
                        <div class="form-row">
                            <div class="form-group">
                                <label>Aluno (RA)</label>
                                <select id="matriculaAluno" required><option value="">Selecione o aluno...</option></select>
                            </div>
                            <div class="form-group">
                                <label>Turma</label>
                                <select id="matriculaTurma" required><option value="">Selecione a turma...</option></select>
                            </div>
                            <div class="form-group">
                                <label>Status</label>
                                <select id="matriculaStatus" required>
                                    <option value="ATIVA">Ativa</option>
                                    <option value="TRANCADA">Trancada</option>
                                    <option value="CONCLUIDA">Conclu√≠da</option>
                                    <option value="CANCELADA">Cancelada</option>
                                </select>
                            </div>
                        </div>
                        <button type="submit" class="btn btn-primary">Salvar Matr√≠cula</button>
                        <button type="button" class="btn btn-secondary" onclick="limparFormMatricula()">Limpar</button>
                    </form>
                    <table id="matriculasTable">
                        <thead><tr><th>ID</th><th>Aluno</th><th>Turma</th><th>Status</th><th>Data</th><th>A√ß√µes</th></tr></thead>
                        <tbody></tbody>
                    </table>
                </div>
                
                <!-- Notas -->
                <div class="subsection">
                    <h3>Notas e Avalia√ß√µes</h3>
                    <form id="notaForm">
                        <input type="hidden" id="notaId">
                        <div class="form-row">
                            <div class="form-group">
                                <label>Matr√≠cula (ID)</label>
                                <select id="notaMatricula" required><option value="">Selecione a matr√≠cula...</option></select>
                            </div>
                            <div class="form-group">
                                <label>Tipo de Avalia√ß√£o</label>
                                <select id="notaTipo" required>
                                    <option value="">Selecione...</option>
                                    <option value="PROVA">Prova</option>
                                    <option value="TRABALHO">Trabalho</option>
                                    <option value="SEMINARIO">Semin√°rio</option>
                                    <option value="PROJETO">Projeto</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Nota (0-10)</label>
                                <input type="number" id="notaValor" step="0.01" min="0" max="10" required placeholder="Ex: 8.5">
                            </div>
                            <div class="form-group">
                                <label>Peso</label>
                                <input type="number" id="notaPeso" step="0.01" min="0" max="10" placeholder="Ex: 2.0">
                            </div>
                        </div>
                        <button type="submit" class="btn btn-primary">Salvar Nota</button>
                        <button type="button" class="btn btn-secondary" onclick="limparFormNota()">Limpar</button>
                    </form>
                    <table id="notasTable">
                        <thead><tr><th>ID</th><th>Aluno</th><th>Turma</th><th>Tipo</th><th>Nota</th><th>Peso</th><th>A√ß√µes</th></tr></thead>
                        <tbody></tbody>
                    </table>
                </div>
            </section>
        </div>
        
        <!-- CADASTRO DE ALUNOS -->
        <section class="card section-students" id="cadastroCard">
            <h2>üë®‚Äçüéì Cadastrar Aluno</h2>
            <form id="alunoForm">
                <div class="form-row">
                    <div class="form-group">
                        <label for="ra">RA</label>
                        <input type="text" id="ra" name="ra" required placeholder="Ex: RA2025000004">
                    </div>
                    <div class="form-group">
                        <label for="nome">Nome Completo</label>
                        <input type="text" id="nome" name="nome" required placeholder="Ex: Jo√£o Silva">
                    </div>
                    <div class="form-group">
                        <label for="cpf">CPF</label>
                        <input type="text" id="cpf" name="cpf" required placeholder="000.000.000-00">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="email">Email</label>
                        <input type="email" id="email" name="email" required placeholder="aluno@email.com">
                    </div>
                    <div class="form-group">
                        <label for="telefone">Telefone</label>
                        <input type="text" id="telefone" name="telefone" placeholder="(61) 99999-9999">
                    </div>
                    <div class="form-group">
                        <label for="dataNascimento">Data de Nascimento</label>
                        <input type="date" id="dataNascimento" name="dataNascimento" required>
                    </div>
                </div>
                <button type="submit" class="btn btn-success">Salvar Aluno</button>
                <button type="button" class="btn btn-secondary" onclick="limparFormAluno()">Limpar</button>
            </form>
        </section>
        
        <!-- LISTA DE ALUNOS -->
        <section class="card">
            <h2>üë• Lista de Alunos</h2>
            <button class="btn btn-success" onclick="carregarAlunos()">üîÑ Atualizar Lista</button>
            <table id="alunosTable">
                <thead>
                    <tr>
                        <th>RA</th>
                        <th>Nome</th>
                        <th>CPF</th>
                        <th>Email</th>
                        <th>Telefone</th>
                        <th>Data Nascimento</th>
                        <th>A√ß√µes</th>
                    </tr>
                </thead>
                <tbody id="alunosTableBody">
                </tbody>
            </table>
        </section>
    </main>

    <script>
        const API_URL = 'http://localhost:8080/api';
        
        let userRole = '';
        
        // Verificar autentica√ß√£o
        window.onload = function() {
            const usuario = localStorage.getItem('usuario');
            const grupo = localStorage.getItem('grupo');
            
            if (!usuario) {
                window.location.href = 'login.html';
                return;
            }
            
            userRole = grupo || 'OPERADOR';
            document.getElementById('userName').textContent = usuario + ' (' + userRole + ')';
            
            // Controlar visibilidade baseado no role
            if (userRole === 'OPERADOR') {
                document.getElementById('cadastroCard').style.display = 'none';
            }
            
            // Mostrar menu de gerenciamento para ADMIN e COORDENADOR
            if (userRole === 'ADMIN' || userRole === 'COORDENADOR') {
                document.getElementById('managementSections').style.display = 'block';
                carregarCursos();
                carregarProfessores();
                carregarDisciplinas();
                carregarTurmas();
                carregarMatriculas();
                carregarNotas();
            }
            
            carregarAlunos();
        };
        
        // Logout
        function logout() {
            localStorage.clear();
            window.location.href = 'login.html';
        }
        
        // Cadastrar aluno
        document.getElementById('alunoForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const aluno = {
                ra: document.getElementById('ra').value,
                nome: document.getElementById('nome').value,
                cpf: document.getElementById('cpf').value,
                email: document.getElementById('email').value,
                telefone: document.getElementById('telefone').value,
                dataNascimento: document.getElementById('dataNascimento').value
            };
            
            try {
                const response = await fetch(`${API_URL}/alunos`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(aluno)
                });
                
                if (response.ok) {
                    showAlert('Aluno cadastrado com sucesso!', 'success');
                    document.getElementById('alunoForm').reset();
                    carregarAlunos();
                } else {
                    showAlert('Erro ao cadastrar aluno!', 'error');
                }
            } catch (error) {
                showAlert('Erro ao conectar ao servidor!', 'error');
                console.error(error);
            }
        });
        
        // Carregar lista de alunos
        async function carregarAlunos() {
            console.log('Iniciando carregamento de alunos...');
            try {
                console.log('Fazendo requisi√ß√£o para:', `${API_URL}/alunos`);
                const response = await fetch(`${API_URL}/alunos`);
                console.log('Status da resposta:', response.status);
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const alunos = await response.json();
                console.log('Alunos recebidos:', alunos);
                console.log('Total de alunos:', alunos.length);
                
                const tbody = document.getElementById('alunosTableBody');
                tbody.innerHTML = '';
                
                if (alunos.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="7" style="text-align:center;">Nenhum aluno cadastrado</td></tr>';
                    return;
                }
                
                alunos.forEach(aluno => {
                    const tr = document.createElement('tr');
                    
                    let botoesAcao = '';
                    if (userRole === 'ADMIN') {
                        // Admin: pode editar e excluir
                        botoesAcao = `
                            <button class="btn btn-primary" onclick="editarAluno('${aluno.ra}')">Editar</button>
                            <button class="btn btn-danger" onclick="deletarAluno('${aluno.ra}')">Excluir</button>
                        `;
                    } else if (userRole === 'COORDENADOR') {
                        // Coordenador: pode apenas editar (n√£o pode excluir)
                        botoesAcao = `
                            <button class="btn btn-primary" onclick="editarAluno('${aluno.ra}')">Editar</button>
                        `;
                    } else if (userRole === 'OPERADOR') {
                        // Operador: somente visualiza√ß√£o
                        botoesAcao = '<span style="color: #999;">Somente visualiza√ß√£o</span>';
                    }
                    
                    tr.innerHTML = `
                        <td>${aluno.ra}</td>
                        <td>${aluno.nome}</td>
                        <td>${aluno.cpf}</td>
                        <td>${aluno.email}</td>
                        <td>${aluno.telefone || '-'}</td>
                        <td>${aluno.dataNascimento}</td>
                        <td class="actions">
                            ${botoesAcao}
                        </td>
                    `;
                    tbody.appendChild(tr);
                });
                
                console.log('Tabela atualizada com sucesso!');
            } catch (error) {
                console.error('Erro detalhado:', error);
                showAlert('Erro ao carregar alunos: ' + error.message, 'error');
            }
        }
        
        // Editar aluno
        async function editarAluno(ra) {
            try {
                const response = await fetch(`${API_URL}/alunos/${ra}`);
                if (!response.ok) {
                    showAlert('Erro ao buscar aluno!', 'error');
                    return;
                }
                
                const aluno = await response.json();
                
                document.getElementById('ra').value = aluno.ra;
                document.getElementById('ra').readOnly = true;
                document.getElementById('nome').value = aluno.nome;
                document.getElementById('cpf').value = aluno.cpf;
                document.getElementById('email').value = aluno.email;
                document.getElementById('telefone').value = aluno.telefone || '';
                document.getElementById('dataNascimento').value = aluno.dataNascimento;
                
                const form = document.getElementById('alunoForm');
                form.scrollIntoView({ behavior: 'smooth' });
                
                const submitBtn = form.querySelector('button[type="submit"]');
                submitBtn.textContent = 'Atualizar Aluno';
                submitBtn.onclick = function(e) {
                    e.preventDefault();
                    atualizarAluno(ra);
                };
            } catch (error) {
                showAlert('Erro ao carregar dados do aluno!', 'error');
                console.error(error);
            }
        }
        
        // Atualizar aluno
        async function atualizarAluno(ra) {
            const aluno = {
                ra: ra,
                nome: document.getElementById('nome').value,
                cpf: document.getElementById('cpf').value,
                email: document.getElementById('email').value,
                telefone: document.getElementById('telefone').value,
                dataNascimento: document.getElementById('dataNascimento').value
            };
            
            try {
                const response = await fetch(`${API_URL}/alunos/${ra}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(aluno)
                });
                
                if (response.ok) {
                    showAlert('Aluno atualizado com sucesso!', 'success');
                    resetarFormulario();
                    carregarAlunos();
                } else {
                    showAlert('Erro ao atualizar aluno!', 'error');
                }
            } catch (error) {
                showAlert('Erro ao conectar ao servidor!', 'error');
                console.error(error);
            }
        }
        
        // Resetar formul√°rio
        function resetarFormulario() {
            limparFormAluno();
        }
        
        // Limpar formul√°rio de aluno
        function limparFormAluno() {
            const form = document.getElementById('alunoForm');
            form.reset();
            document.getElementById('ra').readOnly = false;
            const submitBtn = form.querySelector('button[type="submit"]');
            submitBtn.textContent = 'Salvar Aluno';
            submitBtn.onclick = null;
        }
        
        // Deletar aluno
        async function deletarAluno(ra) {
            if (!confirm('Deseja realmente excluir este aluno?')) return;
            
            try {
                const response = await fetch(`${API_URL}/alunos/${ra}`, {
                    method: 'DELETE'
                });
                
                if (response.ok) {
                    showAlert('Aluno exclu√≠do com sucesso!', 'success');
                    carregarAlunos();
                } else {
                    showAlert('Erro ao excluir aluno!', 'error');
                }
            } catch (error) {
                showAlert('Erro ao conectar ao servidor!', 'error');
                console.error(error);
            }
        }
        
        // Mostrar alerta
        function showAlert(message, type) {
            const alert = document.getElementById('alert');
            alert.textContent = message;
            alert.className = `alert alert-${type}`;
            alert.style.display = 'block';
            
            setTimeout(() => {
                alert.style.display = 'none';
            }, 5000);
        }

        // - GERENCIAR CURSOS
        let cursos = [];
        document.getElementById('cursoForm')?.addEventListener('submit', async (e) => {
            e.preventDefault();
            const id = document.getElementById('cursoId').value;
            const curso = {
                nomeCurso: document.getElementById('cursoNome').value,
                descricao: document.getElementById('cursoDescricao').value,
                cargaHoraria: parseInt(document.getElementById('cursoCargaHoraria').value),
                duracaoSemestres: parseInt(document.getElementById('cursoDuracao').value),
                ativo: true,
                criadoPor: localStorage.getItem('usuario')
            };
            try {
                const url = id ? `${API_URL}/cursos/${id}` : `${API_URL}/cursos`;
                const response = await fetch(url, {
                    method: id ? 'PUT' : 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(curso)
                });
                if (response.ok) {
                    showAlert('Curso salvo com sucesso!', 'success');
                    limparFormCurso();
                    carregarCursos();
                    carregarDisciplinas();
                } else {
                    showAlert('Erro ao salvar curso!', 'error');
                }
            } catch (error) {
                showAlert('Erro ao conectar ao servidor!', 'error');
            }
        });

        async function carregarCursos() {
            try {
                const response = await fetch(`${API_URL}/cursos`);
                cursos = await response.json();
                const tbody = document.querySelector('#cursosTable tbody');
                tbody.innerHTML = '';
                cursos.forEach(curso => {
                    const tr = document.createElement('tr');
                    tr.innerHTML = `
                        <td>${curso.idCurso}</td>
                        <td>${curso.nomeCurso}</td>
                        <td>${curso.cargaHoraria}h</td>
                        <td>${curso.duracaoSemestres} sem</td>
                        <td class="actions">
                            <button class="btn btn-primary" onclick="editarCurso(${curso.idCurso})">Editar</button>
                            <button class="btn btn-danger" onclick="deletarCurso(${curso.idCurso})">Excluir</button>
                        </td>
                    `;
                    tbody.appendChild(tr);
                });
                // Atualizar select de disciplinas
                const select = document.getElementById('disciplinaCurso');
                if (select) {
                    select.innerHTML = '<option value="">Selecione...</option>';
                    cursos.forEach(c => {
                        select.innerHTML += `<option value="${c.idCurso}">${c.nomeCurso}</option>`;
                    });
                }
            } catch (error) {
                console.error('Erro ao carregar cursos:', error);
            }
        }

        async function editarCurso(id) {
            try {
                const response = await fetch(`${API_URL}/cursos/${id}`);
                const curso = await response.json();
                document.getElementById('cursoId').value = curso.idCurso;
                document.getElementById('cursoNome').value = curso.nomeCurso;
                document.getElementById('cursoDescricao').value = curso.descricao || '';
                document.getElementById('cursoCargaHoraria').value = curso.cargaHoraria;
                document.getElementById('cursoDuracao').value = curso.duracaoSemestres;
            } catch (error) {
                showAlert('Erro ao carregar curso!', 'error');
            }
        }

        async function deletarCurso(id) {
            if (!confirm('Deseja realmente excluir este curso?')) return;
            try {
                const response = await fetch(`${API_URL}/cursos/${id}`, { method: 'DELETE' });
                if (response.ok) {
                    showAlert('Curso exclu√≠do com sucesso!', 'success');
                    carregarCursos();
                } else {
                    showAlert('Erro ao excluir curso!', 'error');
                }
            } catch (error) {
                showAlert('Erro ao conectar ao servidor!', 'error');
            }
        }

        function limparFormCurso() {
            document.getElementById('cursoId').value = '';
            document.getElementById('cursoForm').reset();
        }

        // - GERENCIAR PROFESSORES
        let professores = [];
        document.getElementById('professorForm')?.addEventListener('submit', async (e) => {
            e.preventDefault();
            const id = document.getElementById('professorId').value;
            const professor = {
                nome: document.getElementById('professorNome').value,
                cpf: document.getElementById('professorCpf').value,
                email: document.getElementById('professorEmail').value,
                telefone: document.getElementById('professorTelefone').value,
                especialidade: document.getElementById('professorEspecialidade').value,
                ativo: true,
                criadoPor: localStorage.getItem('usuario')
            };
            try {
                const url = id ? `${API_URL}/professores/${id}` : `${API_URL}/professores`;
                const response = await fetch(url, {
                    method: id ? 'PUT' : 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(professor)
                });
                if (response.ok) {
                    showAlert('Professor salvo com sucesso!', 'success');
                    limparFormProfessor();
                    carregarProfessores();
                    carregarTurmas();
                } else {
                    showAlert('Erro ao salvar professor!', 'error');
                }
            } catch (error) {
                showAlert('Erro ao conectar ao servidor!', 'error');
            }
        });

        async function carregarProfessores() {
            try {
                const response = await fetch(`${API_URL}/professores`);
                professores = await response.json();
                const tbody = document.querySelector('#professoresTable tbody');
                tbody.innerHTML = '';
                professores.forEach(prof => {
                    const tr = document.createElement('tr');
                    tr.innerHTML = `
                        <td>${prof.idProfessor}</td>
                        <td>${prof.nome}</td>
                        <td>${prof.cpf}</td>
                        <td>${prof.email}</td>
                        <td>${prof.especialidade || '-'}</td>
                        <td class="actions">
                            <button class="btn btn-primary" onclick="editarProfessor(${prof.idProfessor})">Editar</button>
                            <button class="btn btn-danger" onclick="deletarProfessor(${prof.idProfessor})">Excluir</button>
                        </td>
                    `;
                    tbody.appendChild(tr);
                });
                // Atualizar select de turmas
                const select = document.getElementById('turmaProfessor');
                if (select) {
                    select.innerHTML = '<option value="">Selecione...</option>';
                    professores.forEach(p => {
                        select.innerHTML += `<option value="${p.idProfessor}">${p.nome}</option>`;
                    });
                }
            } catch (error) {
                console.error('Erro ao carregar professores:', error);
            }
        }

        async function editarProfessor(id) {
            try {
                const response = await fetch(`${API_URL}/professores/${id}`);
                const prof = await response.json();
                document.getElementById('professorId').value = prof.idProfessor;
                document.getElementById('professorNome').value = prof.nome;
                document.getElementById('professorCpf').value = prof.cpf;
                document.getElementById('professorEmail').value = prof.email;
                document.getElementById('professorTelefone').value = prof.telefone || '';
                document.getElementById('professorEspecialidade').value = prof.especialidade || '';
            } catch (error) {
                showAlert('Erro ao carregar professor!', 'error');
            }
        }

        async function deletarProfessor(id) {
            if (!confirm('Deseja realmente excluir este professor?')) return;
            try {
                const response = await fetch(`${API_URL}/professores/${id}`, { method: 'DELETE' });
                if (response.ok) {
                    showAlert('Professor exclu√≠do com sucesso!', 'success');
                    carregarProfessores();
                } else {
                    showAlert('Erro ao excluir professor!', 'error');
                }
            } catch (error) {
                showAlert('Erro ao conectar ao servidor!', 'error');
            }
        }

        function limparFormProfessor() {
            document.getElementById('professorId').value = '';
            document.getElementById('professorForm').reset();
        }

        // - GERENCIAR DISCIPLINAS
        let disciplinas = [];
        document.getElementById('disciplinaForm')?.addEventListener('submit', async (e) => {
            e.preventDefault();
            const id = document.getElementById('disciplinaId').value;
            const disciplina = {
                nomeDisciplina: document.getElementById('disciplinaNome').value,
                cargaHoraria: parseInt(document.getElementById('disciplinaCargaHoraria').value),
                idCurso: parseInt(document.getElementById('disciplinaCurso').value),
                ativo: true,
                criadoPor: localStorage.getItem('usuario')
            };
            try {
                const url = id ? `${API_URL}/disciplinas/${id}` : `${API_URL}/disciplinas`;
                const response = await fetch(url, {
                    method: id ? 'PUT' : 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(disciplina)
                });
                if (response.ok) {
                    showAlert('Disciplina salva com sucesso!', 'success');
                    limparFormDisciplina();
                    carregarDisciplinas();
                    carregarTurmas();
                } else {
                    showAlert('Erro ao salvar disciplina!', 'error');
                }
            } catch (error) {
                showAlert('Erro ao conectar ao servidor!', 'error');
            }
        });

        async function carregarDisciplinas() {
            try {
                const response = await fetch(`${API_URL}/disciplinas`);
                disciplinas = await response.json();
                const tbody = document.querySelector('#disciplinasTable tbody');
                tbody.innerHTML = '';
                disciplinas.forEach(disc => {
                    const curso = cursos.find(c => c.idCurso === disc.idCurso);
                    const tr = document.createElement('tr');
                    tr.innerHTML = `
                        <td>${disc.idDisciplina}</td>
                        <td>${disc.nomeDisciplina}</td>
                        <td>${disc.cargaHoraria}h</td>
                        <td>${curso ? curso.nomeCurso : disc.idCurso}</td>
                        <td class="actions">
                            <button class="btn btn-primary" onclick="editarDisciplina(${disc.idDisciplina})">Editar</button>
                            <button class="btn btn-danger" onclick="deletarDisciplina(${disc.idDisciplina})">Excluir</button>
                        </td>
                    `;
                    tbody.appendChild(tr);
                });
                // Atualizar select de turmas
                const select = document.getElementById('turmaDisciplina');
                if (select) {
                    select.innerHTML = '<option value="">Selecione...</option>';
                    disciplinas.forEach(d => {
                        select.innerHTML += `<option value="${d.idDisciplina}">${d.nomeDisciplina}</option>`;
                    });
                }
            } catch (error) {
                console.error('Erro ao carregar disciplinas:', error);
            }
        }

        async function editarDisciplina(id) {
            try {
                const response = await fetch(`${API_URL}/disciplinas/${id}`);
                const disc = await response.json();
                document.getElementById('disciplinaId').value = disc.idDisciplina;
                document.getElementById('disciplinaNome').value = disc.nomeDisciplina;
                document.getElementById('disciplinaCargaHoraria').value = disc.cargaHoraria;
                document.getElementById('disciplinaCurso').value = disc.idCurso;
            } catch (error) {
                showAlert('Erro ao carregar disciplina!', 'error');
            }
        }

        async function deletarDisciplina(id) {
            if (!confirm('Deseja realmente excluir esta disciplina?')) return;
            try {
                const response = await fetch(`${API_URL}/disciplinas/${id}`, { method: 'DELETE' });
                if (response.ok) {
                    showAlert('Disciplina exclu√≠da com sucesso!', 'success');
                    carregarDisciplinas();
                } else {
                    showAlert('Erro ao excluir disciplina!', 'error');
                }
            } catch (error) {
                showAlert('Erro ao conectar ao servidor!', 'error');
            }
        }

        function limparFormDisciplina() {
            document.getElementById('disciplinaId').value = '';
            document.getElementById('disciplinaForm').reset();
        }

        // - GERENCIAR TURMAS
        let turmas = [];
        document.getElementById('turmaForm')?.addEventListener('submit', async (e) => {
            e.preventDefault();
            const id = document.getElementById('turmaId').value;
            const turma = {
                nomeTurma: document.getElementById('turmaNome').value,
                idDisciplina: parseInt(document.getElementById('turmaDisciplina').value),
                idProfessor: parseInt(document.getElementById('turmaProfessor').value),
                semestre: parseInt(document.getElementById('turmaSemestre').value),
                ano: parseInt(document.getElementById('turmaAno').value),
                horario: document.getElementById('turmaHorario').value,
                ativo: true,
                criadoPor: localStorage.getItem('usuario')
            };
            try {
                const url = id ? `${API_URL}/turmas/${id}` : `${API_URL}/turmas`;
                const response = await fetch(url, {
                    method: id ? 'PUT' : 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(turma)
                });
                if (response.ok) {
                    showAlert('Turma salva com sucesso!', 'success');
                    limparFormTurma();
                    carregarTurmas();
                    carregarMatriculas();
                } else {
                    showAlert('Erro ao salvar turma!', 'error');
                }
            } catch (error) {
                showAlert('Erro ao conectar ao servidor!', 'error');
            }
        });

        async function carregarTurmas() {
            try {
                const response = await fetch(`${API_URL}/turmas`);
                turmas = await response.json();
                const tbody = document.querySelector('#turmasTable tbody');
                tbody.innerHTML = '';
                turmas.forEach(turma => {
                    const disc = disciplinas.find(d => d.idDisciplina === turma.idDisciplina);
                    const prof = professores.find(p => p.idProfessor === turma.idProfessor);
                    const tr = document.createElement('tr');
                    tr.innerHTML = `
                        <td>${turma.idTurma}</td>
                        <td>${turma.nomeTurma}</td>
                        <td>${disc ? disc.nomeDisciplina : turma.idDisciplina}</td>
                        <td>${prof ? prof.nome : turma.idProfessor}</td>
                        <td>${turma.semestre}¬∫/${turma.ano}</td>
                        <td class="actions">
                            <button class="btn btn-primary" onclick="editarTurma(${turma.idTurma})">Editar</button>
                            <button class="btn btn-danger" onclick="deletarTurma(${turma.idTurma})">Excluir</button>
                        </td>
                    `;
                    tbody.appendChild(tr);
                });
                // Atualizar select de matr√≠culas
                const select = document.getElementById('matriculaTurma');
                if (select) {
                    select.innerHTML = '<option value="">Selecione...</option>';
                    turmas.forEach(t => {
                        const d = disciplinas.find(disc => disc.idDisciplina === t.idDisciplina);
                        select.innerHTML += `<option value="${t.idTurma}">${t.nomeTurma} - ${d ? d.nomeDisciplina : ''}</option>`;
                    });
                }
            } catch (error) {
                console.error('Erro ao carregar turmas:', error);
            }
        }

        async function editarTurma(id) {
            try {
                const response = await fetch(`${API_URL}/turmas/${id}`);
                const turma = await response.json();
                document.getElementById('turmaId').value = turma.idTurma;
                document.getElementById('turmaNome').value = turma.nomeTurma;
                document.getElementById('turmaDisciplina').value = turma.idDisciplina;
                document.getElementById('turmaProfessor').value = turma.idProfessor;
                document.getElementById('turmaSemestre').value = turma.semestre;
                document.getElementById('turmaAno').value = turma.ano;
                document.getElementById('turmaHorario').value = turma.horario || '';
            } catch (error) {
                showAlert('Erro ao carregar turma!', 'error');
            }
        }

        async function deletarTurma(id) {
            if (!confirm('Deseja realmente excluir esta turma?')) return;
            try {
                const response = await fetch(`${API_URL}/turmas/${id}`, { method: 'DELETE' });
                if (response.ok) {
                    showAlert('Turma exclu√≠da com sucesso!', 'success');
                    carregarTurmas();
                } else {
                    showAlert('Erro ao excluir turma!', 'error');
                }
            } catch (error) {
                showAlert('Erro ao conectar ao servidor!', 'error');
            }
        }

        function limparFormTurma() {
            document.getElementById('turmaId').value = '';
            document.getElementById('turmaForm').reset();
            document.getElementById('turmaAno').value = '2025';
        }

        // - GERENCIAR MATR√çCULAS
        let matriculas = [];
        let alunosData = [];
        document.getElementById('matriculaForm')?.addEventListener('submit', async (e) => {
            e.preventDefault();
            const id = document.getElementById('matriculaId').value;
            const matricula = {
                raAluno: document.getElementById('matriculaAluno').value,
                idTurma: parseInt(document.getElementById('matriculaTurma').value),
                status: document.getElementById('matriculaStatus').value,
                dataMatricula: new Date().toISOString().split('T')[0],
                criadoPor: localStorage.getItem('usuario')
            };
            try {
                const url = id ? `${API_URL}/matriculas/${id}` : `${API_URL}/matriculas`;
                const response = await fetch(url, {
                    method: id ? 'PUT' : 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(matricula)
                });
                if (response.ok) {
                    showAlert('Matr√≠cula salva com sucesso!', 'success');
                    limparFormMatricula();
                    carregarMatriculas();
                } else {
                    showAlert('Erro ao salvar matr√≠cula!', 'error');
                }
            } catch (error) {
                showAlert('Erro ao conectar ao servidor!', 'error');
            }
        });

        async function carregarMatriculas() {
            try {
                const response = await fetch(`${API_URL}/matriculas`);
                matriculas = await response.json();
                
                // Carregar alunos se necess√°rio
                if (alunosData.length === 0) {
                    const alunosResp = await fetch(`${API_URL}/alunos`);
                    alunosData = await alunosResp.json();
                    const select = document.getElementById('matriculaAluno');
                    if (select) {
                        select.innerHTML = '<option value="">Selecione...</option>';
                        alunosData.forEach(a => {
                            select.innerHTML += `<option value="${a.ra}">${a.nome} (${a.ra})</option>`;
                        });
                    }
                }
                
                const tbody = document.querySelector('#matriculasTable tbody');
                tbody.innerHTML = '';
                matriculas.forEach(mat => {
                    const aluno = alunosData.find(a => a.ra === mat.raAluno);
                    const turma = turmas.find(t => t.idTurma === mat.idTurma);
                    const tr = document.createElement('tr');
                    tr.innerHTML = `
                        <td>${mat.idMatricula}</td>
                        <td>${aluno ? aluno.nome : mat.raAluno}</td>
                        <td>${turma ? turma.nomeTurma : mat.idTurma}</td>
                        <td>${mat.status}</td>
                        <td>${mat.dataMatricula || '-'}</td>
                        <td class="actions">
                            <button class="btn btn-primary" onclick="editarMatricula(${mat.idMatricula})">Editar</button>
                            <button class="btn btn-danger" onclick="deletarMatricula(${mat.idMatricula})">Excluir</button>
                        </td>
                    `;
                    tbody.appendChild(tr);
                });
                
                // Atualizar select de notas com matr√≠culas
                const selectNota = document.getElementById('notaMatricula');
                if (selectNota) {
                    selectNota.innerHTML = '<option value="">Selecione...</option>';
                    matriculas.forEach(m => {
                        const aluno = alunosData.find(a => a.ra === m.raAluno);
                        const turma = turmas.find(t => t.idTurma === m.idTurma);
                        const disciplina = disciplinas.find(d => d.idDisciplina === turma?.idDisciplina);
                        selectNota.innerHTML += `<option value="${m.idMatricula}">Mat.${m.idMatricula} - ${aluno?.nome || m.raAluno} - ${disciplina?.nomeDisciplina || turma?.nomeTurma || 'Turma ' + m.idTurma}</option>`;
                    });
                }
            } catch (error) {
                console.error('Erro ao carregar matr√≠culas:', error);
            }
        }

        async function editarMatricula(id) {
            try {
                const response = await fetch(`${API_URL}/matriculas/${id}`);
                const mat = await response.json();
                document.getElementById('matriculaId').value = mat.idMatricula;
                document.getElementById('matriculaAluno').value = mat.raAluno;
                document.getElementById('matriculaTurma').value = mat.idTurma;
                document.getElementById('matriculaStatus').value = mat.status;
            } catch (error) {
                showAlert('Erro ao carregar matr√≠cula!', 'error');
            }
        }

        async function deletarMatricula(id) {
            if (!confirm('Deseja realmente excluir esta matr√≠cula?')) return;
            try {
                const response = await fetch(`${API_URL}/matriculas/${id}`, { method: 'DELETE' });
                if (response.ok) {
                    showAlert('Matr√≠cula exclu√≠da com sucesso!', 'success');
                    carregarMatriculas();
                } else {
                    showAlert('Erro ao excluir matr√≠cula!', 'error');
                }
            } catch (error) {
                showAlert('Erro ao conectar ao servidor!', 'error');
            }
        }

        function limparFormMatricula() {
            document.getElementById('matriculaId').value = '';
            document.getElementById('matriculaForm').reset();
        }

        // - GERENCIAR NOTAS
        document.getElementById('notaForm')?.addEventListener('submit', async (e) => {
            e.preventDefault();
            const id = document.getElementById('notaId').value;
            const nota = {
                idMatricula: parseInt(document.getElementById('notaMatricula').value),
                tipoAvaliacao: document.getElementById('notaTipo').value,
                nota: parseFloat(document.getElementById('notaValor').value),
                peso: parseFloat(document.getElementById('notaPeso').value) || null,
                dataAvaliacao: new Date().toISOString().split('T')[0],
                criadoPor: localStorage.getItem('usuario')
            };
            try {
                const url = id ? `${API_URL}/notas/${id}` : `${API_URL}/notas`;
                const response = await fetch(url, {
                    method: id ? 'PUT' : 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(nota)
                });
                if (response.ok) {
                    showAlert('Nota salva com sucesso!', 'success');
                    limparFormNota();
                    carregarNotas();
                } else {
                    showAlert('Erro ao salvar nota!', 'error');
                }
            } catch (error) {
                showAlert('Erro ao conectar ao servidor!', 'error');
            }
        });

        async function carregarNotas() {
            try {
                const response = await fetch(`${API_URL}/notas`);
                const notas = await response.json();
                const tbody = document.querySelector('#notasTable tbody');
                tbody.innerHTML = '';
                notas.forEach(nota => {
                    const notaClass = nota.nota >= 7 ? 'color:green' : nota.nota >= 5 ? 'color:orange' : 'color:red';
                    
                    // Buscar informa√ß√µes da matr√≠cula
                    const matricula = matriculas.find(m => m.idMatricula === nota.idMatricula);
                    const aluno = alunosData.find(a => a.ra === matricula?.raAluno);
                    const turma = turmas.find(t => t.idTurma === matricula?.idTurma);
                    const disciplina = disciplinas.find(d => d.idDisciplina === turma?.idDisciplina);
                    
                    const tr = document.createElement('tr');
                    tr.innerHTML = `
                        <td>${nota.idNota}</td>
                        <td>${aluno ? aluno.nome : (matricula?.raAluno || '-')}</td>
                        <td>${disciplina ? disciplina.nomeDisciplina : (turma ? turma.nomeTurma : '-')}</td>
                        <td>${nota.tipoAvaliacao}</td>
                        <td style="${notaClass};font-weight:bold">${nota.nota.toFixed(2)}</td>
                        <td>${nota.peso ? nota.peso.toFixed(2) : '-'}</td>
                        <td class="actions">
                            <button class="btn btn-primary" onclick="editarNota(${nota.idNota})">Editar</button>
                            <button class="btn btn-danger" onclick="deletarNota(${nota.idNota})">Excluir</button>
                        </td>
                    `;
                    tbody.appendChild(tr);
                });
            } catch (error) {
                console.error('Erro ao carregar notas:', error);
            }
        }

        async function editarNota(id) {
            try {
                const response = await fetch(`${API_URL}/notas/${id}`);
                const nota = await response.json();
                document.getElementById('notaId').value = nota.idNota;
                document.getElementById('notaMatricula').value = nota.idMatricula;
                document.getElementById('notaTipo').value = nota.tipoAvaliacao;
                document.getElementById('notaValor').value = nota.nota;
                document.getElementById('notaPeso').value = nota.peso || '';
            } catch (error) {
                showAlert('Erro ao carregar nota!', 'error');
            }
        }

        async function deletarNota(id) {
            if (!confirm('Deseja realmente excluir esta nota?')) return;
            try {
                const response = await fetch(`${API_URL}/notas/${id}`, { method: 'DELETE' });
                if (response.ok) {
                    showAlert('Nota exclu√≠da com sucesso!', 'success');
                    carregarNotas();
                } else {
                    showAlert('Erro ao excluir nota!', 'error');
                }
            } catch (error) {
                showAlert('Erro ao conectar ao servidor!', 'error');
            }
        }

        function limparFormNota() {
            document.getElementById('notaId').value = '';
            document.getElementById('notaForm').reset();
        }
    </script>
</body>
</html>
